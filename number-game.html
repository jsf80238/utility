<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">

    <title>Word guessing game</title>

    <style>
        html {
            font-family: monospace;
        }

        body {
            width: 50%;
            max-width: 800px;
            min-width: 480px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
        }

        table {
            border-collapse: collapse;
            width: 90%;
            height: 100%;
            display: block;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }

        table tr td {
            border: 1px solid #000;
            padding: 5px;
        }

        .galleryData {
            display: flex;
            justify-content: center;
        }

        .guesses {
            display: flex;
            justify-content: center;
        }

        .form input {
            width: 150px;
        }

        .lastResult {
            color: white;
            padding: 3px;
        }

        input:invalid {
            border: red solid 3px;
        }

        .galleryNotGuessed {
            color: black;
            background-color: #D7DBDD;
        }

        .galleryGuessedCorrectly {
            color: black;
            background-color: blue;
        }

        .galleryGuessedIncorrectly {
            color: black;
            background-color: red;
        }

        .guessTableIncorrect {
            color: black;
            background-color: red;
        }

        .guessTableCorrect {
            color: black;
            background-color: lightblue;
        }

        .guessTableExactlyCorrect {
            color: black;
            background-color: lightgreen;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>Word Guessing Game</h1>
    <p>We have selected a random 5-letter word. See if you can guess it in as few turns as possible. We'll tell you
        what letters were correct.</p>
    <p></p>
    <div class="">
        <table class="">
            <tbody class="galleryData">
            </tbody>
        </table>
    </div>
    <!-- <hr>
    <div class="guesses">
        <table class="guesses">
            <tbody class="guesses"></tbody>
        </table>
    </div> -->
    <hr>
    <div>
        <table class="guesses" id="guesses">
            <tbody></tbody>
        </table>
    </div>
    <hr>
    <div class="form">
        <label for="guessField">Enter a guess: </label>
        <input id="guessField" class="guessField" type="text" value="" pattern="\w{5}" required />
        <input type="submit" value="Submit guess" class="guessSubmit">
        <p class="lastResult"></p>
    </div>

    <script>
        const answerLength = 5;
        // const arr = ["abide", "abode", "about", "above", "abuse", "acted", "actor"];
        const arr = ["abide"];

        const galleryNotGuessed = { backgroundColor: "lightgrey", foregroundColor: "black", style: "galleryNotGuessed" }
        const galleryGuessedCorrectly = { backgroundColor: "lightgreen", foregroundColor: "black", style: "galleryGuessedCorrectly" }
        const galleryGuessedIncorrectly = { backgroundColor: "lightgrey", foregroundColor: "red", style: "galleryGuessedIncorrectly" }
        const guessTableIncorrect = { backgroundColor: "black", foregroundColor: "white", style: "guessTableIncorrect" }
        const guessTableCorrect = { backgroundColor: "lightgreen", foregroundColor: "black", style: "guessTableCorrect" }
        const guessTableExactlyCorrect = { backgroundColor: "lightgreen", foregroundColor: "darkgreen", style: "guessTableExactlyCorrect" }

        const guesses = document.querySelector(".guesses");
        const guessesTable = guesses.getElementsByTagName("tbody")[0];
        const lastResult = document.querySelector(".lastResult");
        const galleryData = document.querySelector(".galleryData");
        const guessSubmit = document.querySelector(".guessSubmit");
        const guessField = document.querySelector(".guessField");

        let correct_answer = "";
        let galleryDict = {};

        function analyzeGuess(guess) {
            let returnArray = [];
            for (let i = 0; i < guess.length; i++) {
                let guessedLetter = [...guess][i];
                let answerLetter = [...correct_answer][i];
                if (correct_answer.includes(guessedLetter)) {
                    galleryDict[guessedLetter] = galleryGuessedCorrectly;
                    if (guessedLetter === answerLetter) {
                        returnArray.push(guessTableExactlyCorrect);
                    } else {
                        returnArray.push(guessTableCorrect);
                    }
                } else {
                    galleryDict[guessedLetter] = galleryGuessedIncorrectly;
                    returnArray.push(guessTableIncorrect);
                }
            }
            return returnArray;
        }

        function displayGuesses(userGuess) {
            const guessAnalysisArray = analyzeGuess(userGuess);
            let row = guessesTable.insertRow()
            for (i = 0; i < answerLength; i++) {
                const letter = [...userGuess][i]
                const td = document.createElement('td')
                td.appendChild(document.createTextNode(letter));
                td.className = guessAnalysisArray[i].style
                row.appendChild(td);
            }
        }

        function displayGallery() {
            var tableRows = galleryData.getElementsByTagName('tr');
            if (tableRows.length > 0) {
                galleryData.removeChild(tableRows[0]);
            }

            row = document.createElement('tr');
            for (const letter in galleryDict) {
                const td = document.createElement('td');
                td.appendChild(document.createTextNode(letter));
                td.className = galleryDict[letter].style
                row.appendChild(td);
            }
            galleryData.appendChild(row)
        }

        function resetGame() {
            for (i = 0; i < guessesTable.rows.length; i++) {
                guessesTable.deleteRow(0)
            }
            if (typeof resetButton !== 'undefined') {
                resetButton.parentNode.removeChild(resetButton);
            }

            guessField.disabled = false;
            guessSubmit.disabled = false;
            guessField.value = "";
            guessField.focus();

            lastResult.style.backgroundColor = "white";

            correct_answer = arr[(Math.floor(Math.random() * arr.length))].toUpperCase();

            for (const char of 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') {
                galleryDict[char] = galleryNotGuessed;
            }

            displayGallery();
        }

        function setGameOver() {
            guessField.disabled = true;
            guessSubmit.disabled = true;
            resetButton = document.createElement("button");
            resetButton.textContent = "Start new game";
            document.body.append(resetButton);
            resetButton.addEventListener("click", resetGame);
        }

        function checkGuess() {
            const userGuess = guessField.value.toUpperCase();

            displayGuesses(userGuess);
            displayGallery();

            if (userGuess === correct_answer) {
                lastResult.textContent = "Congratulations! You got it right!";
                lastResult.style.backgroundColor = "green";
                setGameOver();
            } else {
                lastResult.textContent = "";
                lastResult.style.backgroundColor = "white";
            }

            guessField.value = "";
            guessField.focus();
        }

        resetGame();
        guessSubmit.addEventListener("click", checkGuess);

    </script>
</body>

</html>